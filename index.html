<!doctype html>
<html>
	<head>
		<title>Game</title>
	</head>
	<body style="margin:0px;background-color:navy;">
		<canvas style="background-color:white;" width="600" height="600"></canvas>
		<script src="/socket.io/socket.io.js"></script>
		<script
  src="https://code.jquery.com/jquery-3.3.1.js"
  integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
  crossorigin="anonymous"></script>
  		<script src="https://scalarfield.github.io/js/tools/memekit.js"></script>
		<script>

let c = document.querySelector('canvas');
let f = c.getContext('2d');

let playerList = [];

			
let socket = io();
socket.on('newplayer', (n)=>{
	if(playerList[n] === undefined){
		playerList.push(new Player(300, 300, `hsl(${60*n}, 70%, 70%)` ));
	}
});

socket.on('dcplayer', (n)=>{
	playerList[n] = null;
});

socket.on('move', (n)=>{
	let yAngle = n.y;
	if(yAngle > 90){yAngle = 90};
	if(yAngle < -90){yAngle = -90};
	playerList[n.key].y = 300 - yAngle*300/90;
	let xAngle = n.x;
	if(xAngle > 90 && xAngle < 180){
		xAngle = 90;
	} else {
		if(xAngle < 360 && xAngle > 180){xAngle -= 360};
		if(xAngle < -90){xAngle = -90};
	}
	playerList[n.key].x = 300 - xAngle*300/90;
});

class Player{
	constructor(x, y, color){
		this.x = x;
		this.y = y;
		this.color = color;
	}
	draw(ctx){
		ctx.fillRect(this.x, this.y, 40, 40);
	}
}

function render(){
 f.clearRect(0, 0, 600, 600);
 for(let p : playerList){
	if(p !== null){
		p.draw(f);
	}
 }
}

let loop = setInterval(render, 1000/60);

		</script>
	</body>
</html>
